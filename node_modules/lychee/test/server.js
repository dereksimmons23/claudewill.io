var PostsStorage = [{
	id: 1,
	title: 'First',
	body: 'First'
}, {
	id: 2,
	title: 'Second',
	body: 'Second'
}];

var connect = require('connect');
var router = require('route66');
var app = connect();
app.use(connect.bodyParser());

router.get('/', function(req, res){
	res.end(JSON.stringify(PostsStorage));
});

router.post('/', function(req, res){
	var obj = {
		id: PostsStorage.length + 1,
		title: req.body.title,
		body: req.body.body
	};
	
	PostsStorage.push(obj);
	res.end(JSON.stringify(obj));
});

router.del('/', function(req, res){
	PostsStorage = [];
	res.end();
});

router.get('/:id', function(req, res){
	var length = PostsStorage.length;
	for(var i = 0; i < length; i++) {
		if(PostsStorage[i].id == parseInt(req.params.id)) {
			return res.end(JSON.stringify(PostsStorage[i]));
		}
	}
});

router.put('/:id', function(req, res){
	var obj = {
		id: parseInt(req.body.id),
		title: req.body.title,
		body: req.body.body
	};
	
	var length = PostsStorage.length;
	for(var i = 0; i < length; i++) {
		if(PostsStorage[i].id == obj.id) {
			PostsStorage[i] = obj;
			return res.end(JSON.stringify(obj));
		}
	}
});

router.del('/:id', function(req, res){
	var index;
	var length = PostsStorage.length;
	for(var i = 0; i < length; i++) {
		if(PostsStorage[i].id == parseInt(req.params.id)) {
			index = i;
		}
	}
	
	PostsStorage.splice(index, 1);
	res.end();
});

app.use(router);
app.listen(8080);